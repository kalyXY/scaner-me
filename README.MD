# ğŸ“ SystÃ¨me de PrÃ©sence QR Professionnel

Un systÃ¨me professionnel de gestion des prÃ©sences et examens utilisant des codes QR, construit avec PHP 8.2, MySQL et une architecture MVC moderne.

## âœ¨ FonctionnalitÃ©s

- ğŸ“± **Scanner QR Moderne** - Interface camÃ©ra avec scan en temps rÃ©el
- ğŸ“Š **Tableau de bord professionnel** - Interface responsive avec Bootstrap 5
- ğŸ¯ **ContrÃ´le d'examens** - VÃ©rification automatique des paiements
- ğŸ“ˆ **Rapports dÃ©taillÃ©s** - Statistiques de prÃ©sence par session et Ã©tudiant
- ğŸ’³ **Gestion des paiements** - Suivi des paiements d'examens
- ğŸ” **Autorisations d'examen** - ContrÃ´le d'accÃ¨s basÃ© sur les paiements
- ğŸ“„ **Export CSV** - Export des donnÃ©es de prÃ©sence
- ğŸ—ï¸ **Architecture MVC** - Code structurÃ© et maintenable
- ğŸ” **Logging avancÃ©** - TraÃ§abilitÃ© complÃ¨te des actions
- ğŸš€ **API RESTful** - Endpoints modernes avec rÃ©ponses JSON
- ğŸ³ **Docker Ready** - DÃ©ploiement simplifiÃ© avec Docker
- ğŸ“± **Mobile First** - OptimisÃ© pour smartphones et tablettes

## ğŸ› ï¸ PrÃ©requis

- **Docker & Docker Compose** (recommandÃ©)
- Ou **PHP 8.1+**, **MySQL 8.0+**, **Composer** (installation manuelle)

## âš¡ Installation Rapide (Docker)

1. **Cloner et dÃ©marrer**
   ```bash
   git clone <repository-url>
   cd qr-attendance-system
   make up
   ```

2. **Installer les dÃ©pendances**
   ```bash
   docker compose exec app composer install
   ```

3. **Configurer la base de donnÃ©es**
   ```bash
   docker compose exec db mysql -u root -p < schema.sql
   ```

4. **Initialiser avec des donnÃ©es de test**
   ```bash
   docker compose exec app php scripts/seed_sample_data.php --clear
   ```

5. **AccÃ©der Ã  l'application**
   - Dashboard: http://localhost:8080/dashboard
   - Scanner QR: http://localhost:8080/scanner
   - API Health: http://localhost:8080/api/health

## ğŸ”§ Configuration

### Variables d'environnement

Copiez `.env.example` vers `.env` et ajustez les valeurs :

```bash
cp .env.example .env
```

Variables principales :
- `APP_ENV` - Environnement (development/production)
- `DB_HOST`, `DB_NAME`, `DB_USER`, `DB_PASS` - Configuration base de donnÃ©es
- `LOG_LEVEL` - Niveau de logging (DEBUG/INFO/WARNING/ERROR)

### Configuration avancÃ©e

Le fichier `config/app.php` contient toutes les configurations systÃ¨me :
- ParamÃ¨tres base de donnÃ©es
- Configuration logging
- ParamÃ¨tres sÃ©curitÃ©
- Options QR codes

## ğŸ“¡ API Endpoints

### PrÃ©sences
- `POST /api/scan` - Enregistrer une prÃ©sence
- `GET /api/sessions?date=YYYY-MM-DD` - Sessions du jour
- `GET /api/attendance/session?session_id=ID` - PrÃ©sences d'une session
- `GET /api/attendance/date?date=YYYY-MM-DD` - PrÃ©sences du jour

### SystÃ¨me
- `GET /api/health` - Ã‰tat de santÃ© du systÃ¨me
- `GET /api/dashboard` - DonnÃ©es du tableau de bord
- `GET /api/export/csv` - Export CSV des prÃ©sences

### Exemples d'utilisation

**Enregistrer une prÃ©sence :**
```bash
curl -X POST http://localhost:8080/api/scan \
  -H "Content-Type: application/json" \
  -d '{"uuid": "00000000-0000-0000-0000-000000000001"}'
```

**Obtenir les sessions du jour :**
```bash
curl http://localhost:8080/api/sessions?date=2024-01-15
```

## ğŸ§ª Test Rapide

**DonnÃ©es de test disponibles :**
- 8 Ã©tudiants avec UUIDs de `00000000-0000-0000-0000-000000000001` Ã  `000000008`
- Sessions programmÃ©es pour aujourd'hui
- 4 premiers Ã©tudiants ont payÃ© leurs frais d'examen

**Test du scanner :**
1. Aller sur http://localhost:8080/scanner
2. Cliquer "Saisie Manuelle"
3. Entrer : `00000000-0000-0000-0000-000000000001`
4. Valider â†’ Doit afficher les infos de Alice Dupont

**Voir le guide complet :** [TESTING.md](TESTING.md)

## ğŸ—ï¸ Architecture

```
src/
â”œâ”€â”€ Controllers/     # ContrÃ´leurs MVC
â”œâ”€â”€ Models/         # ModÃ¨les de donnÃ©es
â”œâ”€â”€ Services/       # Logique mÃ©tier
â”œâ”€â”€ Config/         # Configuration systÃ¨me
â”œâ”€â”€ Exceptions/     # Exceptions personnalisÃ©es
â””â”€â”€ Utils/          # Fonctions utilitaires

templates/          # Templates Twig
public/            # Point d'entrÃ©e web
tests/             # Tests unitaires et d'intÃ©gration
```

## ğŸ¯ GÃ©nÃ©ration des codes QR

```bash
# GÃ©nÃ©rer tous les codes QR des Ã©tudiants actifs
php scripts/generate_qr.php

# Ou via Docker
docker compose exec app php scripts/generate_qr.php
```

Les codes QR sont gÃ©nÃ©rÃ©s dans `assets/qr/` et contiennent l'URL de scan avec l'UUID de l'Ã©tudiant.

## ğŸ§ª Tests et QualitÃ©

```bash
# Tests unitaires
composer test

# Analyse statique
composer analyse

# VÃ©rification du style de code
composer cs-check

# Correction automatique du style
composer cs-fix
```

## ğŸ“Š Monitoring et Logs

### Logs
- **Emplacement** : `logs/app.log`
- **Rotation** : 30 jours
- **Niveaux** : DEBUG, INFO, WARNING, ERROR, CRITICAL

### Health Check
```bash
curl http://localhost:8080/api/health
```

VÃ©rifie :
- Connexion base de donnÃ©es
- SystÃ¨me de fichiers
- Extensions PHP requises

## ğŸš€ DÃ©ploiement Production

### Docker Production
```bash
# Build image de production
docker build -t qr-attendance:latest .

# DÃ©marrer en production
docker run -d \
  --name qr-attendance \
  -p 80:80 \
  -e APP_ENV=production \
  -e DB_HOST=your-db-host \
  -e DB_NAME=school_mvp \
  -e DB_USER=your-user \
  -e DB_PASS=your-password \
  qr-attendance:latest
```

### Optimisations Production
- **OPcache** activÃ© pour de meilleures performances
- **Logs** configurÃ©s pour la production
- **Headers de sÃ©curitÃ©** configurÃ©s
- **Compression gzip** activÃ©e

## ğŸ”’ SÃ©curitÃ©

- **Validation d'entrÃ©e** stricte
- **Ã‰chappement des sorties** automatique
- **Headers de sÃ©curitÃ©** configurÃ©s
- **Logging des tentatives** d'accÃ¨s
- **Protection CSRF** (Ã  venir)

## ğŸ“š Base de DonnÃ©es

### Structure principale
- `students` - Ã‰tudiants et leurs UUIDs
- `courses` - Cours et matiÃ¨res
- `course_sessions` - Sessions de cours planifiÃ©es
- `attendance` - Enregistrements de prÃ©sence
- `payments` - Paiements d'examens
- `exam_authorizations` - Autorisations d'examen

### Migrations
```bash
# Importer le schÃ©ma initial
mysql -u root -p school_mvp < schema.sql
```

## ğŸ¤ Contribution

1. Fork le projet
2. CrÃ©er une branche feature (`git checkout -b feature/amazing-feature`)
3. Commit les changements (`git commit -m 'Add amazing feature'`)
4. Push vers la branche (`git push origin feature/amazing-feature`)
5. Ouvrir une Pull Request

## ğŸ“„ Licence

Ce projet est sous licence MIT. Voir le fichier `LICENSE` pour plus de dÃ©tails.

## ğŸ†˜ Support

Pour toute question ou problÃ¨me :
1. VÃ©rifiez les logs : `tail -f logs/app.log`
2. Testez le health check : `curl http://localhost:8080/api/health`
3. Consultez la documentation API intÃ©grÃ©e

---

**Version 2.0** - SystÃ¨me professionnel de gestion des prÃ©sences QR

